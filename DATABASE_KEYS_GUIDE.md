# دليل مفاتيح قاعدة البيانات لمشروع "بوصلة العافية"

لفهم كيفية عمل النظام وربط البيانات ببعضها، يجب فهم أنواع **المفاتيح (Keys)** التي استخدمناها في تصميم الجداول. هذه المفاتيح هي التي تضمن أن كل مريض مرتبط بطبيبه، وكل وصفة طبية مرتبطة بصاحبها.

## 1. المفتاح الأساسي (Primary Key - PK)
هو الهوية الفريدة لكل سجل في الجدول. لا يمكن أن يتكرر ولا يمكن أن يكون فارغاً.
- **مثال:** في جدول `users` (المستخدمين)، المفتاح الأساسي هو `user_id`. هذا الرقم يميزك أنت عن أي مستخدم آخر في النظام.
- **الفائدة:** يضمن لنا الوصول السريع والدقيق لأي معلومة (مثل جلب بيانات مريض محدد برقم هويته).

## 2. المفتاح الأجنبي (Foreign Key - FK)
هو حقل في جدول يشير إلى المفتاح الأساسي في جدول آخر. هو "الجسر" الذي يربط الجداول ببعضها.
- **مثال:** في جدول `appointments` (المواعيد)، لدينا حقل `patient_id`. هذا الحقل هو مفتاح أجنبي يشير إلى جدول `patients`.
- **الفائدة:** يمنع الأخطاء؛ فلا يمكن حجز موعد لمريض غير موجود أصلاً في النظام.

## 3. الربط في "بوصلة العافية" (أمثلة عملية)

| الجدول | المفتاح الأساسي (PK) | المفتاح الأجنبي (FK) | الغرض من الربط |
| :--- | :--- | :--- | :--- |
| **Users** | `user_id` | - | الجدول الأم لكل المستخدمين |
| **Patients** | `patient_id` | `user_id` | ربط بيانات المريض بحسابه الأساسي |
| **Appointments** | `appointment_id` | `patient_id`, `doctor_id` | ربط الموعد بالمريض والطبيب معاً |
| **Hospital_Doctors** | `(hospital_id, doctor_id)` | `hospital_id`, `doctor_id` | ربط الطبيب بالمستشفى الذي يعمل فيه |

## 4. المفاتيح المركبة (Composite Keys)
في بعض الحالات، نستخدم حقلين معاً لتمثيل مفتاح واحد.
- **مثال:** في جدول `hospital_doctors` (صفحة 96)، نستخدم رقم المستشفى مع رقم الطبيب كمفتاح واحد. هذا يمنع إضافة نفس الطبيب لنفس المستشفى مرتين بالخطأ.

## 5. لماذا هذه المفاتيح مهمة لمشروعك؟
1. **سلامة البيانات:** تمنع حذف طبيب له مواعيد مسجلة إلا بعد معالجة تلك المواعيد.
2. **الأداء:** تجعل عمليات البحث عن "كل مواعيد المريض X" سريعة جداً.
3. **الأمان:** تسمح لنا في Supabase بكتابة سياسات (RLS) تقول: "اسمح للمريض برؤية المواعيد التي تحمل الـ `patient_id` الخاص به فقط".

---
**نصيحة تقنية:** عند التعامل مع قاعدة البيانات برمجياً، استخدم دائماً هذه المفاتيح (UUIDs) للبحث والربط بدلاً من الأسماء، لأن الأسماء قد تتكرر أما المفاتيح فلا.
